{"ast":null,"code":"var _jsxFileName = \"E:\\\\project\\\\cafeproject\\\\cafein_client\\\\src\\\\components\\\\Map.js\";\nimport React, { useState, useEffect } from 'react';\nimport './Map.css';\nimport axios from 'axios';\nimport { NaverMap } from 'react-naver-maps'; // 패키지 불러오기\n\nimport CafeMarker from './Cafemarker';\nimport GpsMarker from './Gpsmarker';\nimport { getCurrentLocation } from './../utils/utils';\n\nconst useAxios = url => {\n  const [state, setState] = useState({\n    data: null,\n    loading: true,\n    error: null\n  });\n  const [trigger, setTrigger] = useState(0);\n\n  const refetch = () => {\n    setState({\n      loading: true\n    });\n    setTrigger(Date.now());\n  };\n\n  const getData = async () => {\n    const result = await axios.post(url);\n    setState({\n      data: result.data,\n      loading: false,\n      error: null\n    });\n\n    if (result.error) {\n      setState({\n        data: result.data,\n        loading: false,\n        error: result.error\n      });\n    }\n  };\n\n  useEffect(() => {\n    getData();\n  }, [trigger]);\n\n  if (!url) {\n    return;\n  }\n\n  return {\n    state,\n    refetch\n  };\n};\n/*\r\nconst watchPosition = () => {\r\n  if (navigator.geolocation) {\r\n\t\tconst watchId = navigator.geolocation.watchPosition(function(position) {\r\n\t\t\tconsole.log(position.coords);\r\n\t\t\tsetUserPos(position.coords);\r\n\t\t});\r\n  } \r\n}\r\n*/\n\n\nconst Map = ({\n  markerStatus\n}) => {\n  //\tconst { state, refetch } = useAxios(\"/getcafes\");\n  //\tconst {data, error} = state;\n  // const {data: {getMarkerStatus: markerStatus}} = useQuery(GET_MARKER_STATUS);\n  let data = [{\n    name: '할리스커피 고대안암점',\n    lat: 37.5847549,\n    lon: 127.0292435,\n    busy: '[[-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]]',\n    outlet: -1,\n    seat: -1,\n    area: -1,\n    noise: -1\n  }, {\n    name: '할리스커피 고대안암점',\n    lat: 37.5847549,\n    lon: 127.0292435,\n    busy: '[[-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]]',\n    outlet: -1,\n    seat: -1,\n    area: -1,\n    noise: -1\n  }]; //getCurrentLocation();\n\n  let mapRef;\n  let [mapBounds, setBounds] = useState(0); // 맵 전체 크기  \n\n  let [center, setCenter] = useState({\n    lat: 37.5668144,\n    lng: 126.9783882\n  }); // 지도의 center 값\n\n  let [zoom, setZoom] = useState(0); // 지도의 zoom 값\n\n  let [posChanged, setPosChanged] = useState(0); // 지도 position 변화 감지.\n\n  let [userPos, setUserPos] = useState(0); // user GPS Position \n  // Get GPS Position data \n\n  useEffect(() => {\n    async function getPosData() {\n      const cur_pos = await getCurrentLocation();\n\n      if (cur_pos) {\n        setCenter(cur_pos);\n        setUserPos(cur_pos);\n      }\n    }\n\n    getPosData();\n  }, [posChanged]); // Get Map Center data\n\n  useEffect(() => {\n    setBounds(mapRef.getBounds());\n  }, [center]);\n  const cafes = data;\n  let render_cafes = [];\n\n  if (cafes) {\n    let d = new Date();\n    let day_of_week = d.getDay(); // sunday : 0, mon : 1, ...\n\n    let cur_hour = d.getHours();\n\n    for (let i = 0; i < cafes.length; i++) {\n      // 마커 이미지를 생성합니다\n      const regex = /[\\[\\]]/;\n      let arr = cafes[i].busy.split(regex);\n      let filtered = arr.filter(function (el) {\n        return el !== \"\" && el !== \", \";\n      });\n      let cur_busy = filtered[day_of_week].split(', ')[cur_hour];\n      let cur_busy_color;\n\n      if (cur_busy >= 80) {\n        // red (Busy : 80-100)\n        cur_busy_color = \"red\";\n      } else if (cur_busy >= 40) {\n        // yellow (Busy : 40-59)\n        cur_busy_color = \"yellow\";\n      } else if (cur_busy >= 0) {\n        // green (Busy : 0-39)\n        cur_busy_color = \"green\";\n      } else if (cur_busy === '-1.0') {\n        // grey (Busy : not_opened)\n        cur_busy_color = \"grey\";\n      } else {\n        //예외처리\n        console.log(\"it is wrong busy data\");\n        continue;\n      }\n\n      cafes[i]['cur_busy_color'] = cur_busy_color;\n      cafes[i]['cur_busy'] = cur_busy.toString();\n      const navermaps = window.naver.maps; // 혹은 withNavermaps hoc을 사용\n      // mapBounds 안에 있는 marker만 render 하도록 \n\n      if (mapBounds && mapBounds.hasLatLng(navermaps.LatLng(cafes[i].lat, cafes[i].lon))) {\n        render_cafes.push(cafes[i]);\n      }\n    }\n  } //const latlng = new navermaps.LatLng(37.3595704, 127.105399)\n  //\t\t<button onClick={refetch}>Refetch</button> \n  //\t\t<h2>{loading && \"Loading\" }</h2>\n\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"map_container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(NaverMap, {\n    mapDivId: 'maps-getting-started-uncontrolled' // default: react-naver-map\n    ,\n    naverRef: ref => {\n      mapRef = ref;\n    },\n    style: {\n      width: '100%',\n      // 네이버지도 가로 길이\n      height: '100%' // 네이버지도 세로 길이\n\n    },\n    defaultCenter: {\n      lat: 37.5668144,\n      lng: 126.9783882\n    } // 지도 초기 위치\n    ,\n    center: center,\n    defaultZoom: 16 // 지도 초기 확대 배율\n    ,\n    onCenterChanged: center_pos => {\n      setCenter(center_pos);\n    },\n    onZoomChanged: zoomListener => {\n      setZoom(zoomListener);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 4\n    }\n  }, render_cafes && render_cafes.map((cafe, index) => /*#__PURE__*/React.createElement(CafeMarker, {\n    lat: cafe.lat,\n    lng: cafe.lon,\n    busy: cafe.cur_busy,\n    busy_color: cafe.cur_busy_color,\n    cafe_name: cafe.name,\n    key: index,\n    markerStatus: markerStatus,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 6\n    }\n  })), userPos && /*#__PURE__*/React.createElement(GpsMarker, {\n    lat: userPos.lat,\n    lng: userPos.lng,\n    key: \"1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 18\n    }\n  })));\n};\n\nexport default Map;","map":{"version":3,"sources":["E:/project/cafeproject/cafein_client/src/components/Map.js"],"names":["React","useState","useEffect","axios","NaverMap","CafeMarker","GpsMarker","getCurrentLocation","useAxios","url","state","setState","data","loading","error","trigger","setTrigger","refetch","Date","now","getData","result","post","Map","markerStatus","name","lat","lon","busy","outlet","seat","area","noise","mapRef","mapBounds","setBounds","center","setCenter","lng","zoom","setZoom","posChanged","setPosChanged","userPos","setUserPos","getPosData","cur_pos","getBounds","cafes","render_cafes","d","day_of_week","getDay","cur_hour","getHours","i","length","regex","arr","split","filtered","filter","el","cur_busy","cur_busy_color","console","log","toString","navermaps","window","naver","maps","hasLatLng","LatLng","push","ref","width","height","center_pos","zoomListener","map","cafe","index"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport './Map.css';\r\nimport axios from 'axios';\r\nimport { NaverMap } from 'react-naver-maps'; // 패키지 불러오기\r\nimport CafeMarker from './Cafemarker';\r\nimport GpsMarker from './Gpsmarker';\r\nimport { getCurrentLocation } from './../utils/utils';\r\n\r\n\r\n\r\n\r\nconst useAxios = (url) => {\r\n\tconst [state, setState] = useState({\r\n\t\tdata: null,\r\n\t\tloading: true,\r\n\t\terror: null\r\n\t});\r\n\r\n\tconst [trigger, setTrigger] = useState(0);\r\n\r\n\tconst refetch = () => { \r\n\t\tsetState({\r\n\t\t\tloading: true\r\n\t\t});\r\n\t\tsetTrigger(Date.now());\r\n\t};\r\n\r\n\tconst getData = async () => {\r\n\t\tconst result = await axios.post(url);\r\n\t\tsetState({\r\n\t\t\tdata: result.data,\r\n\t\t\tloading: false,\r\n\t\t\terror: null\r\n\t\t});\r\n\t\tif (result.error) {\r\n\t\t\tsetState({data:result.data, loading:false, error:result.error});\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => { getData(); }, [trigger]);\r\n\tif (!url) {\r\n\t\treturn;\r\n\t}\r\n\treturn {state, refetch};\r\n};\r\n\r\n\r\n\r\n/*\r\nconst watchPosition = () => {\r\n  if (navigator.geolocation) {\r\n\t\tconst watchId = navigator.geolocation.watchPosition(function(position) {\r\n\t\t\tconsole.log(position.coords);\r\n\t\t\tsetUserPos(position.coords);\r\n\t\t});\r\n  } \r\n}\r\n*/\r\n\r\n\r\n\r\nconst Map = ({markerStatus}) => {\r\n//\tconst { state, refetch } = useAxios(\"/getcafes\");\r\n//\tconst {data, error} = state;\r\n\t// const {data: {getMarkerStatus: markerStatus}} = useQuery(GET_MARKER_STATUS);\r\n\r\nlet data = [{\r\n    name: '할리스커피 고대안암점',\r\n    lat: 37.5847549,\r\n    lon: 127.0292435,\r\n    busy: '[[-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]]',\r\n    outlet: -1,\r\n    seat: -1,\r\n    area: -1,\r\n    noise: -1\r\n  },\r\n  {\r\n    name: '할리스커피 고대안암점',\r\n    lat: 37.5847549,\r\n    lon: 127.0292435,\r\n    busy: '[[-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]]',\r\n    outlet: -1,\r\n    seat: -1,\r\n    area: -1,\r\n    noise: -1\r\n  }];\r\n\r\n\r\n\r\n    \r\n\r\n\t//getCurrentLocation();\r\n\tlet mapRef;\r\n\t\r\n\t\r\n\tlet [mapBounds, setBounds] = useState(0); // 맵 전체 크기  \r\n\tlet [center, setCenter] = useState({lat:37.5668144, lng:126.9783882}); // 지도의 center 값\r\n\tlet [zoom, setZoom] = useState(0); // 지도의 zoom 값\r\n\tlet [posChanged, setPosChanged] = useState(0); // 지도 position 변화 감지.\r\n\tlet [userPos, setUserPos] = useState(0); // user GPS Position \r\n\r\n\r\n\t// Get GPS Position data \r\n\tuseEffect(() => {\r\n  \tasync function getPosData() {\r\n\t\t\tconst cur_pos = await getCurrentLocation();\r\n\t\t\tif (cur_pos) {\r\n\t\t\t\tsetCenter(cur_pos);\r\n\t\t\t\tsetUserPos(cur_pos);\r\n\t\t\t}\r\n  \t}\r\n\t\tgetPosData();\r\n\t}, [posChanged]);\r\n\r\n\r\n\t// Get Map Center data\r\n\tuseEffect(() => { \r\n\t\tsetBounds(mapRef.getBounds());\r\n\t }, [center]);\r\n\r\n\r\n\r\n\tconst cafes = data;\r\n\tlet render_cafes = [];\r\n\r\n\tif (cafes) { \r\n  \tlet d = new Date();\r\n    let day_of_week = d.getDay(); // sunday : 0, mon : 1, ...\r\n    let cur_hour = d.getHours();\r\n\t\tfor (let i = 0; i < cafes.length; i ++) {\r\n\t\t\t// 마커 이미지를 생성합니다\r\n\r\n\t\t\tconst regex = /[\\[\\]]/;\r\n\t\t\tlet arr = cafes[i].busy.split(regex);\r\n\t\t\tlet filtered = arr.filter(function (el) {\r\n\t\t\t\treturn el !== \"\" && el !== \", \";\r\n\t\t\t});\r\n\r\n\t\t\tlet cur_busy = filtered[day_of_week].split(', ')[cur_hour];\r\n\r\n\t\t\tlet cur_busy_color; \r\n\t\t\tif (cur_busy >= 80) {\r\n\t\t\t// red (Busy : 80-100)\r\n\t\t\t\tcur_busy_color = \"red\"; \r\n\t\t\t} else if (cur_busy >= 40) {\r\n\t\t\t// yellow (Busy : 40-59)\r\n\t\t\t\tcur_busy_color = \"yellow\"; \r\n\t\t\t} else if (cur_busy >= 0) {\r\n\t\t\t// green (Busy : 0-39)\r\n\t\t\t\tcur_busy_color = \"green\"; \r\n\t\t\t} else if (cur_busy === '-1.0') {\r\n\t\t\t// grey (Busy : not_opened)\r\n\t\t\t\tcur_busy_color = \"grey\"; \r\n\t\t\t} else {\r\n\t\t\t//예외처리\r\n\t\t\t\tconsole.log(\"it is wrong busy data\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcafes[i]['cur_busy_color'] = cur_busy_color;\r\n\t\t\tcafes[i]['cur_busy'] = cur_busy.toString();\r\n\t\t\t\r\n \t\t\tconst navermaps = window.naver.maps; // 혹은 withNavermaps hoc을 사용\r\n\r\n\t\t\t// mapBounds 안에 있는 marker만 render 하도록 \r\n\t\t\tif (mapBounds && mapBounds.hasLatLng(navermaps.LatLng(cafes[i].lat,cafes[i].lon))){\r\n\t\t\t\trender_cafes.push(cafes[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n \t//const latlng = new navermaps.LatLng(37.3595704, 127.105399)\r\n\t//\t\t<button onClick={refetch}>Refetch</button> \r\n\t//\t\t<h2>{loading && \"Loading\" }</h2>\r\n \treturn (\r\n\t\t<div className=\"map_container\">\r\n\t\t\t<NaverMap\r\n\t\t\t\tmapDivId={'maps-getting-started-uncontrolled'} // default: react-naver-map\r\n\t\t\t\tnaverRef={ref => { mapRef = ref}}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\twidth: '100%', // 네이버지도 가로 길이\r\n\t\t\t\t\theight: '100%' // 네이버지도 세로 길이\r\n\t\t\t\t}}\r\n\t\t\t\tdefaultCenter={{lat: 37.5668144, lng: 126.9783882}} // 지도 초기 위치\r\n\t\t\t\tcenter={center}\r\n\t\t\t\tdefaultZoom={16} // 지도 초기 확대 배율\r\n\t\t\t\tonCenterChanged={center_pos => { setCenter(center_pos) }}\r\n\t\t\t\tonZoomChanged={zoomListener => { setZoom(zoomListener) }}\r\n\t\t\t>\r\n\t\t\t\t{ render_cafes  && render_cafes.map((cafe, index) => (\r\n\t\t\t\t\t<CafeMarker lat={cafe.lat} lng={cafe.lon} busy={cafe.cur_busy} busy_color={cafe.cur_busy_color} cafe_name={cafe.name} key={index} markerStatus={markerStatus}/>\r\n\t\t\t\t))}\r\n\r\n\t\t\t\t{ userPos && <GpsMarker lat={userPos.lat} lng={userPos.lng} key='1'/> }\r\n\t\t\r\n\t\t\t</NaverMap>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default Map;\r\n"]},"metadata":{},"sourceType":"module"}